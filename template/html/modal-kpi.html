<!-- KPI Detail Modal -->
<div class="modal-overlay" id="kpiDetailModal">
    <div class="modal-container modal-lg">
        <div class="modal-header">
            <div class="modal-header-left">
                <h2 class="modal-title" id="kpiModalTitle">KPI Details</h2>
                <p class="modal-subtitle" id="kpiModalSubtitle">Detailed breakdown and trends</p>
            </div>
            <div class="modal-header-right">
                <button class="modal-btn primary" id="kpiModalViewAll">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="3" y="3" width="18" height="18" rx="2"/><path d="M3 9h18M9 21V9"/>
                    </svg>
                    View All Transactions
                </button>
                <button class="modal-close" aria-label="Close">&#10005;</button>
            </div>
        </div>
        <div class="modal-body">
            <!-- Summary Stats -->
            <div class="kpi-modal-summary" id="kpiModalSummary">
                <div class="kpi-summary-stat">
                    <span class="kpi-summary-label">Total</span>
                    <span class="kpi-summary-value blue" id="kpiModalTotal">$0</span>
                </div>
                <div class="kpi-summary-stat">
                    <span class="kpi-summary-label">Transaction Count</span>
                    <span class="kpi-summary-value" id="kpiModalCount">0</span>
                </div>
                <div class="kpi-summary-stat">
                    <span class="kpi-summary-label">Monthly Average</span>
                    <span class="kpi-summary-value" id="kpiModalAvg">$0</span>
                </div>
                <div class="kpi-summary-stat">
                    <span class="kpi-summary-label">Trend</span>
                    <span class="kpi-summary-change" id="kpiModalTrend">-</span>
                </div>
            </div>

            <!-- Trend Chart -->
            <div class="kpi-modal-trend">
                <div class="kpi-modal-section-header">
                    <span class="kpi-modal-section-title">Monthly Trend</span>
                    <div class="kpi-modal-section-controls">
                        <button class="kpi-section-btn active" data-kpi-chart="line">Line</button>
                        <button class="kpi-section-btn" data-kpi-chart="bar">Bar</button>
                    </div>
                </div>
                <div class="kpi-modal-chart-container">
                    <canvas id="kpiTrendChart"></canvas>
                </div>
            </div>

            <!-- Breakdown Chart -->
            <div class="kpi-modal-breakdown">
                <div class="kpi-modal-section-header">
                    <span class="kpi-modal-section-title">Breakdown</span>
                    <div class="kpi-modal-section-controls">
                        <button class="kpi-section-btn active" data-kpi-breakdown="category">Category</button>
                        <button class="kpi-section-btn" data-kpi-breakdown="department">Dept</button>
                        <button class="kpi-section-btn" data-kpi-breakdown="division">Division</button>
                    </div>
                </div>
                <div class="kpi-modal-chart-container">
                    <canvas id="kpiBreakdownChart"></canvas>
                </div>
            </div>

            <!-- Top Contributors Table -->
            <div class="kpi-modal-contributors">
                <div class="kpi-modal-section-header">
                    <span class="kpi-modal-section-title">Top 10 Contributors</span>
                </div>
                <div style="max-height: 250px; overflow-y: auto;">
                    <table class="kpi-contributors-table">
                        <thead>
                            <tr>
                                <th class="col-rank">#</th>
                                <th>Description</th>
                                <th>Category</th>
                                <th>Date</th>
                                <th>Amount</th>
                            </tr>
                        </thead>
                        <tbody id="kpiContributorsBody"></tbody>
                    </table>
                </div>
            </div>
        </div>
        <div class="modal-footer space-between">
            <span class="kpi-modal-footer-info" id="kpiModalFooterInfo">Showing data from current filter selection</span>
            <button class="modal-btn" id="kpiModalExport">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4M7 10l5 5 5-5M12 15V3"/>
                </svg>
                Export Data
            </button>
        </div>
    </div>
</div>
