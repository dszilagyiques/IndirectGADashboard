<!-- Empty State Overlay -->
<div class="empty-state-overlay" id="emptyStateOverlay">
    <div class="empty-state-content">
        <div class="empty-state-icon">
            <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                <circle cx="11" cy="11" r="8"/>
                <path d="M21 21l-4.35-4.35"/>
                <path d="M8 11h6"/>
            </svg>
        </div>
        <h3>No transactions match your filters</h3>
        <p class="empty-state-suggestions">Try adjusting your filters:</p>
        <ul class="empty-state-tips" id="emptyStateTips">
            <li>Expand the date range</li>
            <li>Select fewer divisions or dept categories</li>
            <li>Clear category filters</li>
        </ul>
        <button class="empty-state-btn" onclick="clearFilters()">Clear All Filters</button>
    </div>
</div>

<!-- Charts Grid -->
<section class="chart-grid">
    <!-- Monthly Trend - MAIN FOCUS with integrated comparison -->
    <div class="chart-card full-width tall" id="mainTrendCard">
        <div class="chart-header">
            <div class="chart-title-section">
                <span class="chart-title">Monthly Cost Trend</span>
                <span class="chart-subtitle" id="monthlyTrendSubtitle">Showing gross costs, allocations, and net total</span>
            </div>
            <div class="chart-controls">
                <div class="chart-control-group">
                    <button class="chart-control-btn active" data-trend-view="summary">Summary</button>
                    <button class="chart-control-btn" data-trend-view="by-division">By Division</button>
                    <button class="chart-control-btn" data-trend-view="by-department">By Dept</button>
                    <button class="chart-control-btn" data-trend-view="by-deptcat">By Dept Cat</button>
                    <button class="chart-control-btn" data-trend-view="by-jobtype">GA vs IN</button>
                </div>
                <button class="chart-expand-btn" data-chart-id="monthlyTrendChart" title="Expand chart">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="15 3 21 3 21 9"/><polyline points="9 21 3 21 3 15"/><line x1="21" y1="3" x2="14" y2="10"/><line x1="3" y1="21" x2="10" y2="14"/>
                    </svg>
                </button>
            </div>
        </div>
        <div class="trend-layout">
            <div class="chart-container">
                <canvas id="monthlyTrendChart"></canvas>
            </div>
            <!-- Integrated Comparison Panel -->
            <div class="comparison-sidebar" id="comparisonPanel">
                <div class="comparison-sidebar-header">
                    <div class="sidebar-title">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 20V10M12 20V4M6 20v-6"/></svg>
                        Compare Periods
                    </div>
                </div>

                <!-- Period Type Toggle -->
                <div class="period-type-toggle">
                    <button class="period-type-btn active" data-period-type="month">Month</button>
                    <button class="period-type-btn" data-period-type="quarter">Quarter</button>
                    <button class="period-type-btn" data-period-type="year">Year</button>
                </div>

                <!-- Period Selection -->
                <div class="period-selectors">
                    <div class="period-selector period-a">
                        <span class="period-label">Period A</span>
                        <select class="period-select" id="periodASelect">
                            <option value="">Select...</option>
                        </select>
                    </div>
                    <div class="period-vs">vs</div>
                    <div class="period-selector period-b">
                        <span class="period-label">Period B</span>
                        <select class="period-select" id="periodBSelect">
                            <option value="">Select...</option>
                        </select>
                    </div>
                </div>

                <div class="comparison-warnings" id="comparisonWarnings" style="display: none;"></div>

                <!-- Shared Filters (apply to both periods) -->
                <div class="comparison-filters-section">
                    <span class="filters-label">Filter both periods by:</span>
                    <div class="comparison-filter-row">
                        <div class="comparison-multiselect" id="compareDivisionsContainer">
                            <button class="multiselect-trigger" id="compareDivisionsTrigger">
                                <span class="multiselect-text">All Divisions</span>
                                <svg width="10" height="10" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="6 9 12 15 18 9"/></svg>
                            </button>
                            <div class="multiselect-dropdown" id="compareDivisionsDropdown">
                                <div class="multiselect-options" id="compareDivisionsOptions"></div>
                            </div>
                        </div>
                    </div>
                    <div class="comparison-filter-row">
                        <div class="comparison-multiselect" id="compareCategoriesContainer">
                            <button class="multiselect-trigger" id="compareCategoriesTrigger">
                                <span class="multiselect-text">All Categories</span>
                                <svg width="10" height="10" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="6 9 12 15 18 9"/></svg>
                            </button>
                            <div class="multiselect-dropdown" id="compareCategoriesDropdown">
                                <div class="multiselect-options" id="compareCategoriesOptions"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <button class="compare-apply-btn" id="applyComparisonBtn">
                    <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20,6 9,17 4,12"/></svg>
                    Compare
                </button>

                <!-- Comparison Results -->
                <div class="comparison-results" id="comparisonResults">
                    <div class="result-header">
                        <span></span>
                        <span class="result-header-a" id="resultHeaderA" title="Period A">A</span>
                        <span class="result-header-b" id="resultHeaderB" title="Period B">B</span>
                        <span class="result-header-var">Î”</span>
                    </div>
                    <div class="result-row">
                        <span class="result-label">Gross</span>
                        <span class="result-a" id="compareGrossA">-</span>
                        <span class="result-b" id="compareGrossB">-</span>
                        <span class="result-var" id="compareGrossVar"><span class="var-amount">-</span><span class="var-pct"></span></span>
                    </div>
                    <div class="result-row">
                        <span class="result-label">Alloc</span>
                        <span class="result-a" id="compareAllocA">-</span>
                        <span class="result-b" id="compareAllocB">-</span>
                        <span class="result-var" id="compareAllocVar"><span class="var-amount">-</span><span class="var-pct"></span></span>
                    </div>
                    <div class="result-row">
                        <span class="result-label">Net</span>
                        <span class="result-a" id="compareNetA">-</span>
                        <span class="result-b" id="compareNetB">-</span>
                        <span class="result-var" id="compareNetVar"><span class="var-amount">-</span><span class="var-pct"></span></span>
                    </div>
                    <div class="result-row">
                        <span class="result-label">Recov%</span>
                        <span class="result-a" id="compareRecoveryA">-</span>
                        <span class="result-b" id="compareRecoveryB">-</span>
                        <span class="result-var" id="compareRecoveryVar"><span class="var-amount">-</span><span class="var-pct"></span></span>
                    </div>
                </div>
                <button class="compare-reset-btn" id="clearComparisonBtn">Reset</button>
            </div>
        </div>
    </div>

    <!-- Cost Explorer - Unified Data Exploration -->
    <div class="chart-card full-width explorer-card">
        <div class="chart-header explorer-header">
            <div class="explorer-title-row">
                <div class="chart-title-section">
                    <span class="chart-title">Cost Explorer</span>
                    <span class="chart-subtitle" id="explorerSubtitle">Division breakdown by value (Top 15)</span>
                </div>
                <div class="explorer-controls">
                    <div class="explorer-dimensions">
                        <button class="explorer-dim-btn active" data-explorer-dim="division">Division</button>
                        <button class="explorer-dim-btn" data-explorer-dim="deptcat">Dept Cat</button>
                        <button class="explorer-dim-btn" data-explorer-dim="costtype">Cost Type</button>
                        <button class="explorer-dim-btn" data-explorer-dim="doctype">Doc Type</button>
                        <button class="explorer-dim-btn" data-explorer-dim="department">Dept</button>
                    </div>
                    <div class="explorer-metrics">
                        <button class="explorer-metric-btn active" data-explorer-metric="amount">$</button>
                        <button class="explorer-metric-btn" data-explorer-metric="count">#</button>
                    </div>
                    <select class="explorer-select" id="explorerSort" title="Sort by">
                        <option value="value">By Value</option>
                        <option value="volume">By Volume</option>
                        <option value="alpha">A-Z</option>
                    </select>
                    <select class="explorer-select" id="explorerLimit" title="Limit">
                        <option value="10">Top 10</option>
                        <option value="15" selected>Top 15</option>
                        <option value="20">Top 20</option>
                        <option value="0">All</option>
                    </select>
                    <button class="chart-expand-btn" data-chart-id="explorerChart" title="Expand chart">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="15 3 21 3 21 9"/><polyline points="9 21 3 21 3 15"/><line x1="21" y1="3" x2="14" y2="10"/><line x1="3" y1="21" x2="10" y2="14"/>
                        </svg>
                    </button>
                </div>
            </div>
        </div>
        <div class="chart-container">
            <canvas id="explorerChart"></canvas>
        </div>
        <div class="explorer-footer" id="explorerFooter">
            <span class="explorer-stat"><strong>0</strong> items</span>
            <span class="explorer-stat"><strong>$0</strong> total</span>
            <span class="explorer-stat"><strong>0</strong> transactions</span>
        </div>
    </div>
</section>

<!-- Hidden elements for legacy JS compatibility -->
<div style="display:none">
    <select id="periodADocTypes"></select>
    <select id="periodBDocTypes"></select>
    <input type="month" id="periodAMonth">
    <input type="month" id="periodBMonth">
    <select id="periodAQuarter"></select>
    <select id="periodBQuarter"></select>
    <select id="periodADivisions"></select>
    <select id="periodBDivisions"></select>
    <select id="periodADeptCategories"></select>
    <select id="periodBDeptCategories"></select>
</div>
